## 一、实验介绍

管道是进程通信的重要手段，在本节实验中，你将学习使用管道来完成两个进程之间的通信。

## 二、实验目的

1. 认识并掌握管道通信的机制与原理

## 三、实验要求

1. 完成指定用户程序代码并提交

## 四、实验步骤

> 注意，以下实验要求你在用户目录`user/src`下添加源代码文件，若你不知道如何添加，请参考Lab1 & Lab2。

### 1. 创建管道

在实验中，我们已经为你封装好了`pipe`函数，传入一个长度为2的`int`数组，即可创建一个管道，这个数组将被分别设置为管道读端[0]与写端[1]的句柄，在后续的操作中可以使用`read`或者`write`对它们进行读写。

```c
int pipe(int fd[2]);
```

由于管道是一种半双工的通信方式，因此，要完成双向的通信，你需要创建两个管道，一个管道用于发送消息，一个管道用于接收消息。

### 2. 创建进程

你可能会想，管道的输入与输出句柄都返回给了当前的进程，那么另外一个进程该如何知道管道的输入与输出句柄呢？这里，我们可以使用操作系统原理课上的`fork`函数来创建一个一模一样的进程，这样两个进程就都能访问到改管道了。

```c
pid_t fork();
```

### 3. 你所要做的

你的进程将会（1）创建两个管道，（2）创建子进程，（2）父进程从标准输入得到一串长度为16的字母序列，（3）再将这串字符序列通过管道传递给`fork`产生的子进程，（4）子进程将这串字符序列转为全小写，（5）通过另外一个管道传回给父进程，（6）父进程打印出这串字符串。

> *一些提示*
>
> 1. 引入"unistd.h"来使用上述函数。
> 2. 当你的程序无法正常工作时，不妨看看内核中关于pipe的实现，它们在"src/fs/pipe.c"中。

## 五、思考

1. 读写管道在什么情况下会堵塞，什么时候不堵塞？
2. 内核还提供了一类名叫`dup`的功能，结合它们，思考一下shell中的管道操作符“`|`”是如何实现的？